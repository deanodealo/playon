<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Vacancies - PlayOn</title>
  <link rel="stylesheet" href="vacancies.css" />
  <link rel="stylesheet" href="index.css" />
</head>
<body>

<!-- Header -->
<header>
  <button class="burger" aria-label="Menu" onclick="toggleMenu()">
    <span></span><span></span><span></span>
  </button>
  <div class="logo-container">
    <img src="images/logo.png" alt="PlayOn Logo" />
  </div>
</header>

<!-- Overlay -->
<div id="menuOverlay" class="overlay" onclick="closeMenu()"></div>

<!-- Side Menu -->
<nav id="sideMenu" class="side-menu">
  <a href="index.html">Home</a>
  <a href="about.html">About</a>
  <a href="vacancies.html">Vacancies</a>
  <a href="#" onclick="showLogin(event)">Login</a>
  <a href="manager-register.html">Register</a>

  <div class="menu-logo">
    <div class="logo-wrapper">
      <img src="images/logo.png" alt="PlayOn Logo">
    </div>
  </div>
</nav>

<!-- Login Popup Overlay -->
<div id="loginOverlay" class="login-overlay" onclick="closeLogin(event)">
  <div class="login-form-container" onclick="event.stopPropagation()">
    <button class="login-close" onclick="closeLogin()" aria-label="Close">&times;</button>
    
    <div class="login-logo">
      <div class="login-logo-wrapper">
        <img src="images/logo.png" alt="PlayOn Logo">
      </div>
    </div>

    <form class="login-form" id="loginForm">
      <h2>Welcome Back</h2>
      
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" required>
      
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" required>
      
      <button type="submit" id="loginBtn">Login</button>
      
      <div class="forgot-password">
        <a href="#" onclick="forgotPassword(event)">Forgot Password?</a>
      </div>
      
      <div id="loginMessage" class="login-message"></div>
      
      <div class="register-link">
        Don't have an account? <a href="manager-register.html">Register here</a>
      </div>
    </form>
  </div>
</div>

<!-- Hero -->
<section class="hero">
  <h1>Team Vacancies</h1>
  <p>Browse open positions and join the right team for you.</p>
</section>

<!-- Page Content -->
<main class="container">
  <!-- Filters -->
  <section class="card filters">
    <h2>üîé Filter Vacancies</h2>
    <select id="filterTeam"><option value="">All Teams</option></select>
    <select id="filterLocation"><option value="">All Locations</option></select>
    <select id="filterPosition">
      <option value="">All Positions</option>
      <option>Goalkeeper</option>
      <option>Defender</option>
      <option>Midfielder</option>
      <option>Striker</option>
      <option>Forward</option>
    </select>
    <select id="filterExperience">
      <option value="">All Levels</option>
      <option>Beginner</option>
      <option>Intermediate</option>
      <option>Advanced</option>
    </select>
  </section>

  <!-- Vacancy Cards -->
  <section class="vacancies" id="vacancyList">
    <!-- Vacancies will be injected here -->
  </section>
</main>

<!-- Footer -->
<footer>
  <p>&copy; 2025 PlayOn. All rights reserved.</p>
  <p>
    <a href="#">About</a> |
    <a href="#">Contact</a> |
    <a href="#">Privacy</a>
  </p>
</footer>

<!-- Menu Toggle Script (matches index.html) -->
<script>
  const burger = document.querySelector('.burger');
  const sideMenu = document.getElementById('sideMenu');
  const overlay = document.getElementById('menuOverlay');

  function toggleMenu() {
    const isOpening = !sideMenu.classList.contains('open');

    sideMenu.classList.toggle('open', isOpening);
    overlay.classList.toggle('active', isOpening);
    burger.classList.toggle('open', isOpening);
    document.body.classList.toggle('menu-open', isOpening);
  }

  function closeMenu() {
    sideMenu.classList.remove('open');
    overlay.classList.remove('active');
    burger.classList.remove('open');
    document.body.classList.remove('menu-open');
  }

  // Close menu when a link is clicked
  document.addEventListener('DOMContentLoaded', function () {
    const links = sideMenu.querySelectorAll('a');
    links.forEach(link => link.addEventListener('click', closeMenu));
  });
</script>

<script src="js/login-popup.js"></script>

<!-- Firebase & App Logic -->
<script type="module">
  import { initializeApp, getApps } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
  import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

  // ===== Firebase Initialization =====
  let app, auth, db;
  if (!getApps().length) {
    const firebaseConfig = {
      apiKey: "AIzaSyAX9ivQ4aKQzokUMEkNpGTIbbAUMJhLlys",
      authDomain: "playon-1a86b.firebaseapp.com",
      projectId: "playon-1a86b",
      storageBucket: "playon-1a86b.appspot.com",
      messagingSenderId: "28141646391",
      appId: "1:28141646391:web:98d83339ed46c17efa45b2",
      measurementId: "G-Z12HWY8PFJ"
    };
    app = initializeApp(firebaseConfig);
  } else {
    app = getApps()[0];
  }

  auth = getAuth(app);
  db = getFirestore(app);
  window.auth = auth;
  window.db = db;
  window.firebaseReady = true;

  console.log('Firebase initialized');

  // ===== Side Menu Login Status =====
  const loginLink = document.querySelector('#sideMenu a[onclick*="showLogin"]');
  onAuthStateChanged(auth, user => {
    if (user) {
      loginLink.textContent = `Logout (${user.email})`;
      loginLink.onclick = async () => {
        await auth.signOut();
        window.location.reload();
      };
    }
  });

  // ===== Load Vacancies on Page Load =====
  document.addEventListener('DOMContentLoaded', () => {
    loadVacancies();
  });

  // ===== Load Vacancies =====
  async function loadVacancies() {
    const vacancyContainer = document.getElementById('vacancyList');
    const filterTeam = document.getElementById('filterTeam');
    const filterLocation = document.getElementById('filterLocation');
    const filterPosition = document.getElementById('filterPosition');
    const filterExperience = document.getElementById('filterExperience');

    try {
      if (!window.firebaseReady) {
        setTimeout(loadVacancies, 500);
        return;
      }

      const querySnapshot = await getDocs(collection(db, 'Vacancies'));

      vacancyContainer.innerHTML = '';
      const teamsSet = new Set();
      const locationsSet = new Set();

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const logoSrc = `images/teamLogos/${data.club.replace(/\s+/g, '')}.png`;

        const card = document.createElement('div');
        card.className = 'vacancy-card';
        card.innerHTML = `
          <img src="${logoSrc}" alt="${data.club} Logo"/>
          <div>
            <h3>${data.club || 'Unknown Team'}</h3>
            <p>‚ö° Position: ${data.position || '-'}</p>
            <p>üéØ Experience: ${data.experience || '-'}</p>
            <p>üìç Location: ${data.location || '-'}</p>
            <p>üë∂ Age: ${data.age || '-'}</p>
          </div>
        `;
        vacancyContainer.appendChild(card);

        if (data.club) teamsSet.add(data.club);
        if (data.location) locationsSet.add(data.location);
      });

      filterTeam.innerHTML = `<option value="">All Teams</option>` + [...teamsSet].map(t => `<option>${t}</option>`).join('');
      filterLocation.innerHTML = `<option value="">All Locations</option>` + [...locationsSet].map(l => `<option>${l}</option>`).join('');

      [filterTeam, filterLocation, filterPosition, filterExperience].forEach(select => {
        select.addEventListener('change', () => {
          const teamVal = filterTeam.value;
          const locationVal = filterLocation.value;
          const positionVal = filterPosition.value;
          const expVal = filterExperience.value;

          document.querySelectorAll('.vacancy-card').forEach(card => {
            const text = card.innerText;
            const show = (!teamVal || text.includes(teamVal)) &&
                         (!locationVal || text.includes(locationVal)) &&
                         (!positionVal || text.includes(positionVal)) &&
                         (!expVal || text.includes(expVal));
            card.style.display = show ? 'flex' : 'none';
          });
        });
      });

    } catch (err) {
      console.error('Error loading vacancies:', err);
      vacancyContainer.innerHTML = '<p>Error loading vacancies. Please refresh.</p>';
    }
  }

</script>

</body>
</html>